<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="diarization">
    <title>Diarization (beta)</title>
    <body>
        <p>Diarization is the process of automatically detecting speakers and speech segments within
            an audio file. Diarization is available via the <codeph>phon-diarization-plugin</codeph>
            which may be downloaded from <xref
                href="https://github.com/phon-ca/phon-diarization-plugin/packages/1025013"
                format="html" scope="external"/>. Diarization actions are available from the <xref
                href="timeline_view.dita">Timeline</xref> view via the
                <uicontrol>Diarization</uicontrol> toolbar button. When clicked the diarization menu
            will be displayed.</p>
    </body>
    <topic id="install_diarization_plugin">
        <title>Installing the Plug-in</title>
        
        <body>
            <p>The following steps will outline how to install the diarization plug-in for the
                current user: <ul>
                    <li>Download the newest version of the diarization plug-in jar from <xref
                            href="https://github.com/phon-ca/phon-diarization-plugin/packages/1025013"
                            format="html" scope="external"/>. Choose the
                            <filepath>phon-diarization-plugin-&lt;version>.jar</filepath> file from
                        the right-hand side of the webpage.</li>
                    <li>Copy this file into the Phon plug-ins folder for this user:<ul
                            id="ul_sn1_mqd_qrb">
                            <li><b>macos (Finder)</b><p>
                                    <ol id="ol_pv1_5qd_qrb">
                                        <li>Open a new <wintitle>Finder</wintitle> window and choose <menucascade>
                                                <uicontrol>Go</uicontrol>
                                                <uicontrol>Go to Folder...</uicontrol>
                                            </menucascade> from the window menu</li>
                                        <li>Type <filepath>~/Library/Application
                                                Support/Phon</filepath> in the dialog and press
                                                <userinput>Enter</userinput></li>
                                        <li>Create a new folder <filepath>plugins</filepath> if this
                                            folder does not already exist</li>
                                        <li>Copy the downloaded file,
                                                <filepath>phon-diarization-plugin-&lt;version>.jar</filepath>
                                            into the <filepath>plugins</filepath> folder.</li>
                                        <li>Restart Phon</li>
                                    </ol>
                                </p></li>
                            <li><b>macos (command line)</b><p>Copy and paste the following into a
                                    new <wintitle>Terminal</wintitle> window (create destination
                                    folder if it does not
                                    exist:)<codeblock>cp ~/Downloads/phon-diarization-plugin-&lt;version>.jar ~/Library/Application\ Support/Phon/plugins/</codeblock></p></li>
                            <li><b>windows</b><p>
                                    <ol id="ol_imf_frd_qrb">
                                        <li>Open a new <wintitle>Explorer</wintitle> window and type
                                                <filepath>%APPDATA%/Phon</filepath> into the address
                                            bar</li>
                                        <li>Create a new folder <filepath>plugins</filepath> if this
                                            folder does not already exist</li>
                                        <li>Copy the downloaded file,
                                                <filepath>phon-diarization-plugin-&lt;version>.jar</filepath>
                                            into the <filepath>plugins</filepath> folder.</li>
                                        <li>Restart Phon</li>
                                    </ol>
                                </p></li>
                        </ul></li>
                </ul></p>
        </body>
    </topic>
    <topic id="wizard">
        <title>Diarization Wizard</title>
        <body>
            <p>The diarization wizard assists with execution of available diarization tools. This
                will be the first action in the diarization procedure.</p>
            <p>Step one of the wizard is to select the desired diarization tool: <ul>
                    <li><uicontrol>LIUM</uicontrol><p>The LIUM diarization tool (<xref
                                href="https://projets-lium.univ-lemans.fr/spkdiarization/"
                                format="html" scope="external"/>) is an embedded (i.e., offline)
                            diarization tool which is packaged with Phon.</p><ul id="ul_fry_pzb_qrb">
                            <li><uicontrol>Max speakers</uicontrol>
                                <p>Results must conain no more than the specified number of
                                    speakers. A value of <i>0</i> indicates this parameter is not
                                    considered.</p></li>
                        </ul></li>
                    <li><uicontrol>Google Cloud Speech-to-Text</uicontrol><p>Requires a Google Cloud
                            account and Internet access. Audio for the session will be uploaded and
                            transcribed using Google Speech-to-Text. A Google Cloud account is
                            required to use this function. See <xref href="gcs_account_setup.dita"/>
                            for instructions on setting up Google Cloud for use with the diarization
                            tool.</p><ul id="ul_z3f_pzb_qrb">
                            <li><uicontrol>Project id</uicontrol>
                                <p>The project id for your Google Cloud project available from the <menucascade>
                                        <uicontrol>IAM</uicontrol>
                                        <uicontrol>Settings</uicontrol>
                                    </menucascade> page in your Google Cloud account page.</p></li>
                            <li><uicontrol>Google Cloud service account credentials file</uicontrol>
                                <p>The service account credentials file (.json) created when <xref
                                        href="gcs_account_setup.dita"/>.</p></li>
                            <li><uicontrol>Google Cloud Storage bucket location</uicontrol>
                                <p>The storage bucket location if the audio for diarization is
                                    longer than 60s. For best results choose the option closest to
                                    your geographical location.</p></li>
                            <li><uicontrol>Language model</uicontrol>
                                <p>The language model used for Speech-to-Text transcription. (Only
                                    languages which have the diarization feature available are shown
                                    the list, more information can be found at <xref
                                        href="https://cloud.google.com/speech-to-text/docs/languages"
                                        format="html" scope="external"/>.)</p></li>
                            <li><uicontrol>Audio format model</uicontrol>
                                <p>The format of the audio file. Choose the format most appropriate
                                    (for most people this will be <i>video</i>)</p><ul
                                    id="ul_wbr_2lc_qrb">
                                    <li><i>default</i><p>Use this model if your audio does not fit
                                            any of the other models. For example, you can use this
                                            for long-form audio recordings that feature a single
                                            speaker only. The default model will produce
                                            transcription results for any type of audio, including
                                            audio such as video clips that has a separate model
                                            specifically tailored to it. However, recognizing video
                                            clip audio using the default model would like yield
                                            lower-quality results than using the video model.
                                            Ideally, the audio is high-fidelity, recorded at
                                            16,000Hz or greater sampling rate. </p></li>
                                    <li><i>video</i><p>Use this model for transcribing audio from
                                            video clips or other sources (such as podcasts) that
                                            have multiple speakers. This model is also often the
                                            best choice for audio that was recorded with a
                                            high-quality microphone or that has lots of background
                                            noise. For best results, provide audio recorded at
                                            16,000Hz or greater sampling rate.</p></li>
                                    <li><i>phone_call</i><p>Use this model for transcribing audio
                                            from a phone call. Typically, phone audio is recorded at
                                            8,000Hz sampling rate.</p></li>
                                    <li><i>command_and_search</i><p>Use this model for transcribing
                                            shorter audio clips. Some examples include voice
                                            commands or voice search.</p></li>
                                </ul></li>
                            <li><uicontrol>Max speakers</uicontrol><p>Results must conain no more
                                    than the specified number of speakers. A value of <i>0</i>
                                    indicates this parameter is not considered.</p></li>
                        </ul></li>
                </ul>
            </p>
            <p>After clicking <uicontrol>Next</uicontrol> the selected diarization tool will execute
                with output displayed in the <uicontrol>Log</uicontrol> (this may take some time and
                will depend on length of audio.) Once the tool has completed <uicontrol>Diarizaiton
                    Results</uicontrol> will be loaded in the <xref href="timeline_view.dita"
                    >Timeline</xref> view. Results are also saved in the session resources folder as
                    <filepath>__res/diarization/&lt;corpus>_&lt;session>.xml</filepath>. Results may
                be modified saved, and recalled at a later time using the diarization menu.</p>
        </body>
    </topic>
    <topic id="results">
        <title>Modifying and Adding Diarization Results</title>
        <body>
            <p>Diarization results are not automatically added to the session. Results from the
                diarization tool are loaded in the <xref href="timeline_view.dita">Timeline</xref>
                view for review and modification when the diarization wizard has finished.
                Diarization results will appear in place of the normal record tier and may be
                modifed using typical mouse and keyboard interactions (see the <xref
                    href="timeline_view.dita">Timeline</xref> view documentation for details on
                modifying and playing record segments using keyboard and mouse.) A label titled
                    <uicontrol>Diarization Results</uicontrol> will appear above the record grid to
                indicate that results have been loaded. This label will include a '*' if the results
                have been modfied. Results may be saved using the appropariate option in the
                diarization menu and recalled at a later time if necessary.</p>
        </body>
        <topic id="actions">
            <title>Actions</title>
            <body>
                <p>Diarization actions are available from a contextual menu displayed when clicking
                    the <uicontrol>Diarization</uicontrol> button in the <xref
                        href="timeline_view.dita">Timeline</xref> view's toolbar or by clicking the
                        <uicontrol>Diarization Results</uicontrol> label in the <xref
                        href="timeline_view.dita">Timeline</xref> view when results are loaded.
                    Participant specific actions are available from the contextual menu displayed
                    when clicking the participant name in the diarization results tier.</p>
            </body>
            <topic id="merging_speakers">
                <title>Merging Diarization Participants</title>
                <body>
                    <p>The diarization process may produce more speakers then what exists in the
                        audio recording and it is often useful to merge the records between two
                        diarization speakers. To merge participants in loaded diarization results,
                        use the <uicontrol>Assign records to speaker</uicontrol> sub-menu of the
                        participant contextual menu and select a participant under
                            <uicontrol>Diarization Participants</uicontrol>.</p>
                </body>
            </topic>
            <topic id="assign_speaker">
                <title>Assign Records to Existing Participant</title>
                <body>
                    <p>To assign diarization results to an existing session participant, use the
                            <uicontrol>Assign records to speaker</uicontrol> sub-menu of the speaker
                        contextual menu and select a participant under <uicontrol>Session
                            Participants</uicontrol>.</p>
                </body>
            </topic>
            <topic id="adding_records">
                <title>Adding Results to Session</title>
                <body>
                    <p>There are several methods for adding sessions: <ul>
                            <li>Add all diarization results to session <p>Available from the
                                    diarization menu, this will add all diarization results to the
                                    session and close the results.</p></li>
                            <li>All all results for participant to session <p>Available from the
                                    diarization and participant contextual menus; add all
                                    diarization results for a speaker to the session and remove them
                                    from the diarization results. Diarization results will be closed
                                    if all records have been added.</p></li>
                            <li>Add specific records to session <p>Add individual records by
                                    selecting them and clicking the '+' icon dispayed above the
                                    selected records, or by pressing enter, or via the diarization
                                    menu. Records will be removed from the diarization results and
                                    results will be closed if all records have been added.</p></li>
                        </ul></p>
                </body>
            </topic>
        </topic>
    </topic>
</topic>
